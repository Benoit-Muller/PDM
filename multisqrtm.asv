function Y = multisqrtm(A,r)
    [n,m,k] = size(A);
    if nargin==1
        r=n;
    end
    Y = zeros(n,m,k);
    for j=1:k
        [V,D] = eig(A(:,:,j));
        V=real(V);
        D=real(D);
        D(D<0)=0;
        Y(:,:,j) = V*sqrt(D)*V';
        Y(:,:,j)= 0.5*(Y(:,:,j)+multitransp(Y(:,:,j)));
    end
end